<!DOCTYPE html>
<html>
<head>
<title>Chase H.Q.: Routine at 852A</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Chase H.Q.</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="8401.html">8401</a>
</td>
<td class="up">Up: <a href="../maps/all.html#34090">Map</a></td>
<td class="next">
Next: <a href="858C.html">858C</a>
</td>
</tr>
</table>
<div class="description">852A: CPU driver</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
This runs the game loop while driving the car.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">cpu_driver</td>
<td class="address-2"><span id="34090"></span>852A</td>
<td class="instruction">LD HL,($A26C)</td>
<td class="comment-1" rowspan="1">Get road position</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34093"></span>852D</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="4">Subtract centre value. Carry flag will be set if we're on the right hand side of the road</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34094"></span>852E</td>
<td class="instruction">LD DE,$0105</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34097"></span>8531</td>
<td class="instruction">SBC HL,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34099"></span>8533</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34100"></span>8534</td>
<td class="instruction">LD A,$09</td>
<td class="comment-1" rowspan="1">Set input ACCELERATE + RIGHT</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34102"></span>8536</td>
<td class="instruction">JR NC,<a href="852A.html#34115">cd_check_speed</a></td>
<td class="comment-1" rowspan="1">Jump cd_check_speed if we're on the left</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34104"></span>8538</td>
<td class="instruction">LD DE,$00F5</td>
<td class="comment-1" rowspan="2">Subtract "ideal road position"? value. Carry will be set if we're on the right of it.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34107"></span>853B</td>
<td class="instruction">SBC HL,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34109"></span>853D</td>
<td class="instruction">LD A,$0A</td>
<td class="comment-1" rowspan="1">Set input ACCELERATE + LEFT</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34111"></span>853F</td>
<td class="instruction">JR C,<a href="852A.html#34115">cd_check_speed</a></td>
<td class="comment-1" rowspan="1">Jump cd_check_speed if we're on the right</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34113"></span>8541</td>
<td class="instruction">LD A,$08</td>
<td class="comment-1" rowspan="1">Set input ACCELERATE</td>
</tr>
<tr>
<td class="asm-label">cd_check_speed</td>
<td class="address-2"><span id="34115"></span>8543</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">C = A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34116"></span>8544</td>
<td class="instruction">LD HL,($A24A)</td>
<td class="comment-1" rowspan="3">Calculate speed - 150</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34119"></span>8547</td>
<td class="instruction">LD DE,$0096</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34122"></span>854A</td>
<td class="instruction">SBC HL,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34124"></span>854C</td>
<td class="instruction">LD A,($A253)</td>
<td class="comment-1" rowspan="1">Load gear</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34127"></span>854F</td>
<td class="instruction">SBC A,$00</td>
<td class="comment-1" rowspan="1">Set gear to low if speed &lt; 150, otherwise high</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34129"></span>8551</td>
<td class="instruction">JR NZ,<a href="852A.html#34133">cd_set_input</a></td>
<td class="comment-1" rowspan="1">JR NZ,$8555   ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34131"></span>8553</td>
<td class="instruction">SET 4,C</td>
<td class="comment-1" rowspan="1">Set input GEAR</td>
</tr>
<tr>
<td class="asm-label">cd_set_input</td>
<td class="address-2"><span id="34133"></span>8555</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="2">Set user input</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34134"></span>8556</td>
<td class="instruction">LD ($A0D5),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34137"></span>8559</td>
<td class="instruction">CALL <a href="BDFB.html">$BDFB</a></td>
<td class="comment-1" rowspan="1">CALL $BDFB    ; this lot must run a chunk of attract mode funcs</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34140"></span>855C</td>
<td class="instruction">CALL <a href="A7F3.html">$A7F3</a></td>
<td class="comment-1" rowspan="1">CALL $A7F3    ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34143"></span>855F</td>
<td class="instruction">CALL <a href="A60E.html">$A60E</a></td>
<td class="comment-1" rowspan="1">CALL $A60E    ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34146"></span>8562</td>
<td class="instruction">CALL <a href="CD3A.html">$CD3A</a></td>
<td class="comment-1" rowspan="1">CALL $CD3A    ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34149"></span>8565</td>
<td class="instruction">CALL <a href="B848.html">$B848</a></td>
<td class="comment-1" rowspan="1">CALL $B848    ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34152"></span>8568</td>
<td class="instruction">CALL <a href="B9F4.html">$B9F4</a></td>
<td class="comment-1" rowspan="1">CALL $B9F4    ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34155"></span>856B</td>
<td class="instruction">CALL <a href="C452.html">$C452</a></td>
<td class="comment-1" rowspan="1">CALL $C452    ; landscape related</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34158"></span>856E</td>
<td class="instruction">CALL <a href="A579.html">$A579</a></td>
<td class="comment-1" rowspan="1">CALL $A579    ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34161"></span>8571</td>
<td class="instruction">CALL <a href="C0E1.html">$C0E1</a></td>
<td class="comment-1" rowspan="1">CALL $C0E1    ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34164"></span>8574</td>
<td class="instruction">CALL <a href="AB9A.html">$AB9A</a></td>
<td class="comment-1" rowspan="1">CALL $AB9A    ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34167"></span>8577</td>
<td class="instruction">CALL <a href="A955.html">$A955</a></td>
<td class="comment-1" rowspan="1">CALL $A955    ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34170"></span>857A</td>
<td class="instruction">CALL <a href="A97E.html">$A97E</a></td>
<td class="comment-1" rowspan="1">CALL $A97E    ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34173"></span>857D</td>
<td class="instruction">CALL <a href="ADA0.html">$ADA0</a></td>
<td class="comment-1" rowspan="1">CALL $ADA0    ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34176"></span>8580</td>
<td class="instruction">CALL <a href="B063.html">$B063</a></td>
<td class="comment-1" rowspan="1">CALL $B063    ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34179"></span>8583</td>
<td class="instruction">CALL <a href="A399.html">$A399</a></td>
<td class="comment-1" rowspan="1">CALL $A399    ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34182"></span>8586</td>
<td class="instruction">CALL <a href="8F5F.html">$8F5F</a></td>
<td class="comment-1" rowspan="1">CALL $8F5F    ;</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34185"></span>8589</td>
<td class="instruction">JP <a href="B318.html">$B318</a></td>
<td class="comment-1" rowspan="1">JP $B318      ;</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="8401.html">8401</a>
</td>
<td class="up">Up: <a href="../maps/all.html#34090">Map</a></td>
<td class="next">
Next: <a href="858C.html">858C</a>
</td>
</tr>
</table>
<footer>
<div class="release">The incomplete Chase H.Q. disassembly 20230426</div>
<div class="copyright">&copy; 1989 Ocean Software Ltd.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.9.</div>
</footer>
</body>
</html>