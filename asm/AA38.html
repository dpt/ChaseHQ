<!DOCTYPE html>
<html>
<head>
<title>Chase H.Q.: Routine at AA38</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Chase H.Q.</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="A9DE.html">A9DE</a>
</td>
<td class="up">Up: <a href="../maps/all.html#43576">Map</a></td>
<td class="next">
Next: <a href="AAC6.html">AAC6</a>
</td>
</tr>
</table>
<div class="description">AA38: Helicopter related</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
<a href="AB33.html#43913">AB89</a> self modifies <a href="8F5F.html#36772">8FA4</a> to call this.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">helicopter_stuff</td>
<td class="address-2"><span id="43576"></span>AA38</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1">A = B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43577"></span>AA39</td>
<td class="instruction">CP $03</td>
<td class="comment-1" rowspan="2">Return if A != 3</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43579"></span>AA3B</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43580"></span>AA3C</td>
<td class="instruction">LD A,(IY+$4F)</td>
<td class="comment-1" rowspan="2">A = IY[$4F] - IY[$4E]</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43583"></span>AA3F</td>
<td class="instruction">SUB (IY+$4E)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43586"></span>AA42</td>
<td class="instruction">LD D,$00</td>
<td class="comment-1" rowspan="1">D = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43588"></span>AA44</td>
<td class="instruction">LD H,D</td>
<td class="comment-1" rowspan="1">H = D -- ie HL = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43589"></span>AA45</td>
<td class="instruction">LD L,D</td>
<td class="comment-1" rowspan="1">L = D</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43590"></span>AA46</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1">E = A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43591"></span>AA47</td>
<td class="instruction">LD A,($A23F)</td>
<td class="comment-1" rowspan="1">A = fast_counter</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43594"></span>AA4A</td>
<td class="instruction">LD B,$08</td>
<td class="comment-1" rowspan="1">B = 8</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43596"></span>AA4C</td>
<td class="instruction">AND $E0</td>
<td class="comment-1" rowspan="1">A &amp;= $E0</td>
</tr>
<tr>
<td class="asm-label">helicopter_stuff_0</td>
<td class="address-2"><span id="43598"></span>AA4E</td>
<td class="instruction">RLA</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43599"></span>AA4F</td>
<td class="instruction">JR NC,<a href="AA38.html#43602">helicopter_stuff_1</a></td>
<td class="comment-1" rowspan="2">If carry HL += DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43601"></span>AA51</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="asm-label">helicopter_stuff_1</td>
<td class="address-2"><span id="43602"></span>AA52</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-1" rowspan="1">HL &lt;&lt;= 1</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43603"></span>AA53</td>
<td class="instruction">DJNZ <a href="AA38.html#43598">helicopter_stuff_0</a></td>
<td class="comment-1" rowspan="1">Loop <a href="AA38.html#43598">helicopter_stuff_0</a> while B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43605"></span>AA55</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="1">A = H</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43606"></span>AA56</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43607"></span>AA57</td>
<td class="instruction">LD ($AA8D),A</td>
<td class="comment-1" rowspan="1">Self modify 'LD A' @ <a href="AA38.html#43660">AA8C</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43610"></span>AA5A</td>
<td class="instruction">LD A,$00</td>
<td class="comment-1" rowspan="1">A = &lt;self modified&gt; -- Self modified by <a href="AAC6.html#43758">AAEE</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43612"></span>AA5C</td>
<td class="instruction">SUB (IY+$4E)</td>
<td class="comment-1" rowspan="1">A -= IY[$4E]</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43615"></span>AA5F</td>
<td class="instruction">LD ($AA77),A</td>
<td class="comment-1" rowspan="1">Self modify 'ADD A' @ <a href="AA38.html#43638">AA76</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43618"></span>AA62</td>
<td class="instruction">LD B,$05</td>
<td class="comment-1" rowspan="1">B = 5  iterations</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43620"></span>AA64</td>
<td class="instruction">LD A,($A234)</td>
<td class="comment-1" rowspan="2">A = counter_A &amp; 1  -- counter used for turbo smoke</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43623"></span>AA67</td>
<td class="instruction">AND $01</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="43625"></span>
<div class="comments">
<div class="paragraph">
For stage 1 at least this (would) load <span class="register">HL</span> with 0 or 12.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43625"></span>AA69</td>
<td class="instruction">LD HL,($5D08)</td>
<td class="comment-1" rowspan="1">HL = *$5D08</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43628"></span>AA6C</td>
<td class="instruction">JR Z,<a href="AA38.html#43633">loop_aa71</a></td>
<td class="comment-1" rowspan="1">If A was set</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43630"></span>AA6E</td>
<td class="instruction">LD HL,($5D0A)</td>
<td class="comment-1" rowspan="1">HL = *$5D0A</td>
</tr>
<tr>
<td class="asm-label">loop_aa71</td>
<td class="address-2"><span id="43633"></span>AA71</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-1" rowspan="4">DE = wordat(HL); HL += 2</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43634"></span>AA72</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43635"></span>AA73</td>
<td class="instruction">LD D,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43636"></span>AA74</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43637"></span>AA75</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">A = *DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43638"></span>AA76</td>
<td class="instruction">ADD A,$00</td>
<td class="comment-1" rowspan="1">A += &lt;self modified&gt; -- Self modified by <a href="AA38.html#43615">AA5F</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43640"></span>AA78</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1">DE++</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43641"></span>AA79</td>
<td class="instruction">PUSH IY</td>
<td class="comment-1" rowspan="3">Preserve IY, HL, BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43643"></span>AA7B</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43644"></span>AA7C</td>
<td class="instruction">PUSH BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43645"></span>AA7D</td>
<td class="instruction">CALL <a href="AA38.html#43668">sub_AA94</a></td>
<td class="comment-1" rowspan="1">Call sub_AA94</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43648"></span>AA80</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="3">Restore IY, HL, BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43649"></span>AA81</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43650"></span>AA82</td>
<td class="instruction">POP IY</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43652"></span>AA84</td>
<td class="instruction">DJNZ <a href="AA38.html#43633">loop_aa71</a></td>
<td class="comment-1" rowspan="1">Loop loop_aa71 while B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43654"></span>AA86</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-1" rowspan="3">DE = wordat(HL); HL++</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43655"></span>AA87</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43656"></span>AA88</td>
<td class="instruction">LD D,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43657"></span>AA89</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1">A = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43658"></span>AA8A</td>
<td class="instruction">PUSH IY</td>
<td class="comment-1" rowspan="1">Preserve IY</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43660"></span>AA8C</td>
<td class="instruction">LD A,$00</td>
<td class="comment-1" rowspan="1">A = &lt;self modified&gt; -- Self modified by <a href="AA38.html#43607">AA57</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43662"></span>AA8E</td>
<td class="instruction">CALL <a href="AA38.html#43668">sub_AA94</a></td>
<td class="comment-1" rowspan="1">Call sub_AA94</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43665"></span>AA91</td>
<td class="instruction">POP IY</td>
<td class="comment-1" rowspan="1">Restore IY</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43667"></span>AA93</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
<tr>
<td class="asm-label">sub_AA94</td>
<td class="address-2"><span id="43668"></span>AA94</td>
<td class="instruction">LD BC,$0000</td>
<td class="comment-1" rowspan="1">BC = &lt;self modified&gt; -- Self modified by <a href="AAC6.html#43776">AB00</a>, <a href="AAC6.html#43823">move_helicopter_5</a> + others</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43671"></span>AA97</td>
<td class="instruction">NEG</td>
<td class="comment-1" rowspan="1">A = -A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43673"></span>AA99</td>
<td class="instruction">LD ($933E),A</td>
<td class="comment-1" rowspan="1">Self modify 'LD D,x' @ <a href="92E1.html#37693">draw_object_right_8</a> to load A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43676"></span>AA9C</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="4">HL = *DE++</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43677"></span>AA9D</td>
<td class="instruction">INC DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43678"></span>AA9E</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43679"></span>AA9F</td>
<td class="instruction">LD H,$00</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43681"></span>AAA1</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set flags</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43682"></span>AAA2</td>
<td class="instruction">JP P,<a href="AA38.html#43686">helicopter_stuff_2</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43685"></span>AAA5</td>
<td class="instruction">DEC H</td>
<td class="comment-1" rowspan="1">H--</td>
</tr>
<tr>
<td class="asm-label">helicopter_stuff_2</td>
<td class="address-2"><span id="43686"></span>AAA6</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">HL += BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43687"></span>AAA7</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43688"></span>AAA8</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-1" rowspan="1">B = *HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43689"></span>AAA9</td>
<td class="instruction">RLC B</td>
<td class="comment-1" rowspan="3">B &lt;&lt;= 3</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43691"></span>AAAB</td>
<td class="instruction">RLC B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43693"></span>AAAD</td>
<td class="instruction">RLC B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43695"></span>AAAF</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="1">A = D</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43696"></span>AAB0</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set flags</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43697"></span>AAB1</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1">A = E</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43698"></span>AAB2</td>
<td class="instruction">LD C,$00</td>
<td class="comment-1" rowspan="1">C = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43700"></span>AAB4</td>
<td class="instruction">JP M,<a href="AA38.html#43713">helicopter_stuff_3</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43703"></span>AAB7</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if non-zero</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43704"></span>AAB8</td>
<td class="instruction">CP $80</td>
<td class="comment-1" rowspan="2">Jump to <a href="92E1.html#37641">draw_object_right_3</a> if A &gt;= 128</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43706"></span>AABA</td>
<td class="instruction">JP NC,<a href="92E1.html#37641">draw_object_right_3</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43709"></span>AABD</td>
<td class="instruction">ADD A,B</td>
<td class="comment-1" rowspan="1">A += B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43710"></span>AABE</td>
<td class="instruction">JP <a href="9278.html#37530">draw_object_left_1</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="9278.html#37530">draw_object_left_1</a></td>
</tr>
<tr>
<td class="asm-label">helicopter_stuff_3</td>
<td class="address-2"><span id="43713"></span>AAC1</td>
<td class="instruction">ADD A,B</td>
<td class="comment-1" rowspan="1">A += B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43714"></span>AAC2</td>
<td class="instruction">RET NC</td>
<td class="comment-1" rowspan="1">Return if no carry</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43715"></span>AAC3</td>
<td class="instruction">JP <a href="9278.html#37530">draw_object_left_1</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="9278.html#37530">draw_object_left_1</a></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="A9DE.html">A9DE</a>
</td>
<td class="up">Up: <a href="../maps/all.html#43576">Map</a></td>
<td class="next">
Next: <a href="AAC6.html">AAC6</a>
</td>
</tr>
</table>
<footer>
<div class="release">The incomplete Chase H.Q. disassembly 20231102</div>
<div class="copyright">&copy; 1988 Taito Corporation &copy; 1989 Ocean Software Ltd. (Chase H.Q.) © 2023 David Thomas (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.9.</div>
</footer>
</body>
</html>