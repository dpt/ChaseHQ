<!DOCTYPE html>
<html>
<head>
<title>Chase H.Q.: Routine at A97E</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Chase H.Q.</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="A955.html">A955</a>
</td>
<td class="up">Up: <a href="../maps/all.html#43390">Map</a></td>
<td class="next">
Next: <a href="A9DE.html">A9DE</a>
</td>
</tr>
</table>
<div class="description">A97E: main_loop_20</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="8401.html">main_loop</a> and <a href="852A.html">cpu_driver</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">main_loop_20</td>
<td class="address-2"><span id="43390"></span>A97E</td>
<td class="instruction">LD A,$00</td>
<td class="comment-1" rowspan="1">A = &lt;self modified&gt;  -- Self modified by <a href="A955.html#43380">A974</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43392"></span>A980</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="2">Return if <span class="register">A</span> is zero</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43393"></span>A981</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43394"></span>A982</td>
<td class="instruction">LD IYh,$E3</td>
<td class="comment-1" rowspan="2"><span class="register">IY</span> = $E361</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43397"></span>A985</td>
<td class="instruction">LD IYl,$61</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43400"></span>A988</td>
<td class="instruction">LD BC,$1400</td>
<td class="comment-1" rowspan="1">BC = $1400</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43403"></span>A98B</td>
<td class="instruction">LD HL,$ED28</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at (something above the stack)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="43406"></span>
<div class="comments">
<div class="paragraph">
Scan through whatever-it-is for a non-zero byte. Move 4 bytes per iteration.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">ml20_loop1</td>
<td class="address-2"><span id="43406"></span>A98E</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">A = *HL++</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43407"></span>A98F</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="2">Set flags</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43408"></span>A990</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43409"></span>A991</td>
<td class="instruction">JR NZ,<a href="A97E.html#43431">main_loop_20_0</a></td>
<td class="comment-1" rowspan="1">Jump to A9A7 if non-zero</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43411"></span>A993</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="3">HL += 3</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43412"></span>A994</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43413"></span>A995</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label">ml20_loop1_continue</td>
<td class="address-2"><span id="43414"></span>A996</td>
<td class="instruction">DEC IY</td>
<td class="comment-1" rowspan="1">IY--</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43416"></span>A998</td>
<td class="instruction">DJNZ <a href="A97E.html#43406">ml20_loop1</a></td>
<td class="comment-1" rowspan="1">Loop to ml20_loop1 while B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43418"></span>A99A</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="1">A = C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43419"></span>A99B</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set flags</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43420"></span>A99C</td>
<td class="instruction">RET NZ</td>
<td class="comment-1" rowspan="1">Return if non-zero</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43421"></span>A99D</td>
<td class="instruction">LD ($A97F),A</td>
<td class="comment-1" rowspan="1">Self modify LD A @ <a href="A97E.html">main_loop_20</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43424"></span>A9A0</td>
<td class="instruction">LD ($C0BC),A</td>
<td class="comment-1" rowspan="1">Self modify LD A @ <a href="BDFB.html#49339">rm_c0bb</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43427"></span>A9A3</td>
<td class="instruction">LD ($A9DF),A</td>
<td class="comment-1" rowspan="1">Self modify LD A @ <a href="A9DE.html">sub_A9DE</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43430"></span>A9A6</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
<tr>
<td class="asm-label">main_loop_20_0</td>
<td class="address-2"><span id="43431"></span>A9A7</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="2">A = *HL++</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43432"></span>A9A8</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43433"></span>A9A9</td>
<td class="instruction">INC C</td>
<td class="comment-1" rowspan="1">C++</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43434"></span>A9AA</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43435"></span>A9AB</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Bank A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43436"></span>A9AC</td>
<td class="instruction">LD A,(IY+$01)</td>
<td class="comment-1" rowspan="4">L = ~(IY[1] * 2)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43439"></span>A9AF</td>
<td class="instruction">ADD A,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43440"></span>A9B0</td>
<td class="instruction">CPL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43441"></span>A9B1</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43442"></span>A9B2</td>
<td class="instruction">LD H,$E8</td>
<td class="comment-1" rowspan="1">H = $E8</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43444"></span>A9B4</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-1" rowspan="1">D = *HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43445"></span>A9B5</td>
<td class="instruction">DEC L</td>
<td class="comment-1" rowspan="1">L--</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43446"></span>A9B6</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-1" rowspan="1">E = *HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43447"></span>A9B7</td>
<td class="instruction">LD H,$EC</td>
<td class="comment-1" rowspan="1">H = $EC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43449"></span>A9B9</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">A = *HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43450"></span>A9BA</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">L++</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43451"></span>A9BB</td>
<td class="instruction">LD H,(HL)</td>
<td class="comment-1" rowspan="1">H = *HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43452"></span>A9BC</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1">L = A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43453"></span>A9BD</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set flags</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43454"></span>A9BE</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43455"></span>A9BF</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-1" rowspan="1">HL -= DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43457"></span>A9C1</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43458"></span>A9C2</td>
<td class="instruction">LD HL,$0000</td>
<td class="comment-1" rowspan="1">HL = $0000</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43461"></span>A9C5</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Unbank A</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="43462"></span>
<div class="comments">
<div class="paragraph">
Multiplier.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43462"></span>A9C6</td>
<td class="instruction">LD B,$08</td>
<td class="comment-1" rowspan="1">B = 8</td>
</tr>
<tr>
<td class="asm-label">ml20_loop2</td>
<td class="address-2"><span id="43464"></span>A9C8</td>
<td class="instruction">RLA</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43465"></span>A9C9</td>
<td class="instruction">JR NC,<a href="A97E.html#43468">main_loop_20_1</a></td>
<td class="comment-1" rowspan="2">If carry HL += DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43467"></span>A9CB</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="asm-label">main_loop_20_1</td>
<td class="address-2"><span id="43468"></span>A9CC</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-1" rowspan="1">HL &lt;&lt;= 1</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43469"></span>A9CD</td>
<td class="instruction">DJNZ <a href="A97E.html#43464">ml20_loop2</a></td>
<td class="comment-1" rowspan="1">Loop to ml20_loop2 while B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43471"></span>A9CF</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="1">A = H</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43472"></span>A9D0</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43473"></span>A9D1</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">C = A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43474"></span>A9D2</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43475"></span>A9D3</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">HL += BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43476"></span>A9D4</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43477"></span>A9D5</td>
<td class="instruction">EXX</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43478"></span>A9D6</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43479"></span>A9D7</td>
<td class="instruction">LD (HL),E</td>
<td class="comment-1" rowspan="4">DE = wordat(HL); HL += 2</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43480"></span>A9D8</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43481"></span>A9D9</td>
<td class="instruction">LD (HL),D</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43482"></span>A9DA</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43483"></span>A9DB</td>
<td class="instruction">JP <a href="A97E.html#43414">ml20_loop1_continue</a></td>
<td class="comment-1" rowspan="1">Jump to ml20_loop1_continue</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="A955.html">A955</a>
</td>
<td class="up">Up: <a href="../maps/all.html#43390">Map</a></td>
<td class="next">
Next: <a href="A9DE.html">A9DE</a>
</td>
</tr>
</table>
<footer>
<div class="release">The incomplete Chase H.Q. disassembly 20231102</div>
<div class="copyright">&copy; 1988 Taito Corporation &copy; 1989 Ocean Software Ltd. (Chase H.Q.) © 2023 David Thomas (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.9.</div>
</footer>
</body>
</html>