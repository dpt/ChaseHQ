<!DOCTYPE html>
<html>
<head>
<title>Chase H.Q.: Routine at 87DC</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Chase H.Q.</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="873C.html">873C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#34780">Map</a></td>
<td class="next">
Next: <a href="8876.html">8876</a>
</td>
</tr>
</table>
<div class="description">87DC: Sets up the game or the level?</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="8258.html">attract_mode</a>, <a href="8401.html">8401</a>, <a href="858C.html">858C</a>, <a href="873C.html">873C</a> and <a href="F220.html">F220</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Address of 14 bytes of data to be copied to $A26C+</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">setup_game</td>
<td class="address-2"><span id="34780"></span>87DC</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Preserve data pointer</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34781"></span>87DD</td>
<td class="instruction">LD HL,$EE00</td>
<td class="comment-1" rowspan="7">Zero $EE00..$EEFF, and point $A240 at $EE00</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34784"></span>87E0</td>
<td class="instruction">LD ($A240),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34787"></span>87E3</td>
<td class="instruction">LD D,H</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34788"></span>87E4</td>
<td class="instruction">LD E,$01</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34790"></span>87E6</td>
<td class="instruction">LD (HL),L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34791"></span>87E7</td>
<td class="instruction">LD BC,$00FF</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34794"></span>87EA</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34796"></span>87EC</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1">A = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34797"></span>87ED</td>
<td class="instruction">LD HL,$A13E</td>
<td class="comment-1" rowspan="4">Copy (47 bytes) at $A13E to $A16D - saved game state</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34800"></span>87F0</td>
<td class="instruction">LD DE,$A16D</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34803"></span>87F3</td>
<td class="instruction">LD BC,$002F</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34806"></span>87F6</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34808"></span>87F8</td>
<td class="instruction">LD H,D</td>
<td class="comment-1" rowspan="6">Zero 208 bytes at $A19D</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34809"></span>87F9</td>
<td class="instruction">LD L,E</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34810"></span>87FA</td>
<td class="instruction">INC DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34811"></span>87FB</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34812"></span>87FC</td>
<td class="instruction">LD BC,$00CF</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34815"></span>87FF</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34817"></span>8801</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore data pointer</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34818"></span>8802</td>
<td class="instruction">LD BC,$000E</td>
<td class="comment-1" rowspan="2">Copy the 14 bytes passed in to $A26C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34821"></span>8805</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34823"></span>8807</td>
<td class="instruction">CALL <a href="C8BE.html">pre_shift_backdrop</a></td>
<td class="comment-1" rowspan="1">Pre-shift the backdrop image</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34826"></span>880A</td>
<td class="instruction">LD HL,$E34B</td>
<td class="comment-1" rowspan="3">$E34B = 8</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34829"></span>880D</td>
<td class="instruction">LD (HL),$08</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34831"></span>880F</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34832"></span>8810</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="2">$E34C = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34833"></span>8811</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34834"></span>8812</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">$E34D = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34835"></span>8813</td>
<td class="instruction">LD HL,$8F82</td>
<td class="comment-1" rowspan="3">$8F82 = NOP (instruction)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34838"></span>8816</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34839"></span>8817</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34840"></span>8818</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="2">$8F83 = NOP (instruction)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34841"></span>8819</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34842"></span>881A</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">$8F84 = NOP (instruction)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34843"></span>881B</td>
<td class="instruction">LD HL,$8FA4</td>
<td class="comment-1" rowspan="5">NOP 6 bytes [of instructions] at $8FA4</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34846"></span>881E</td>
<td class="instruction">LD B,$06</td>
</tr>
<tr>
<td class="asm-label">setup_game_0</td>
<td class="address-2"><span id="34848"></span>8820</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34849"></span>8821</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34850"></span>8822</td>
<td class="instruction">DJNZ <a href="87DC.html#34848">setup_game_0</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34852"></span>8824</td>
<td class="instruction">LD ($C059),A</td>
<td class="comment-1" rowspan="1">Self modify "LD (HL),xx" at $C058 xx = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34855"></span>8827</td>
<td class="instruction">LD ($B064),A</td>
<td class="comment-1" rowspan="1">Self modify "LD A,xx" at $B063 xx = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34858"></span>882A</td>
<td class="instruction">LD HL,($5D10)</td>
<td class="comment-1" rowspan="2">Set $A191 to value of lods_table[2] (seems to be the perp's car)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34861"></span>882D</td>
<td class="instruction">LD ($A191),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34864"></span>8830</td>
<td class="instruction">LD HL,$EE00</td>
<td class="comment-1" rowspan="7">Zero $EE00..$EEFF, and point $A240 at $EE00 [duplicates work from earlier]</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34867"></span>8833</td>
<td class="instruction">LD ($A240),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34870"></span>8836</td>
<td class="instruction">LD D,H</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34871"></span>8837</td>
<td class="instruction">LD E,$01</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34873"></span>8839</td>
<td class="instruction">LD (HL),L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34874"></span>883A</td>
<td class="instruction">LD BC,$00FF</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34877"></span>883D</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label">loop883f</td>
<td class="address-1"><span id="34879"></span>883F</td>
<td class="instruction">LD B,$20</td>
<td class="comment-1" rowspan="1">32 iterations   - affects start position?</td>
</tr>
<tr>
<td class="asm-label">setup_game_1</td>
<td class="address-2"><span id="34881"></span>8841</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Preserve BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34882"></span>8842</td>
<td class="instruction">LD HL,$A23F</td>
<td class="comment-1" rowspan="1">HL = $A23F</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34885"></span>8845</td>
<td class="instruction">CALL <a href="BDFB.html#48671">$BE1F</a></td>
<td class="comment-1" rowspan="1">Call HUGE function</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34888"></span>8848</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34889"></span>8849</td>
<td class="instruction">DJNZ <a href="87DC.html#34881">setup_game_1</a></td>
<td class="comment-1" rowspan="1">Loop</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34891"></span>884B</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="2">$A254 = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34892"></span>884C</td>
<td class="instruction">LD ($A254),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34895"></span>884F</td>
<td class="instruction">LD A,$F8</td>
<td class="comment-1" rowspan="1">Transition type?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34897"></span>8851</td>
<td class="instruction">CALL <a href="8DF9.html">setup_transition</a></td>
<td class="comment-1" rowspan="1">Call setup_transition</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34900"></span>8854</td>
<td class="instruction">CALL <a href="BDC1.html">clear_screen_set_attrs</a></td>
<td class="comment-1" rowspan="1">Call clear_screen_set_attrs</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34903"></span>8857</td>
<td class="instruction">LD HL,$5820</td>
<td class="comment-1" rowspan="2">Point <span class="register">HL</span> at left light's attributes</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34906"></span>885A</td>
<td class="instruction">CALL <a href="87DC.html#34912">clear_lights</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34909"></span>885D</td>
<td class="instruction">LD HL,$583B</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at right light's attributes then FALL THROUGH</td>
</tr>
<tr>
<td class="asm-label">clear_lights</td>
<td class="address-2"><span id="34912"></span>8860</td>
<td class="instruction">LD C,$04</td>
<td class="comment-1" rowspan="12">Clear the lights' BRIGHT bit</td>
</tr>
<tr>
<td class="asm-label">setup_game_2</td>
<td class="address-2"><span id="34914"></span>8862</td>
<td class="instruction">LD B,$05</td>
</tr>
<tr>
<td class="asm-label">setup_game_3</td>
<td class="address-2"><span id="34916"></span>8864</td>
<td class="instruction">RES 6,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34918"></span>8866</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34919"></span>8867</td>
<td class="instruction">DJNZ <a href="87DC.html#34916">setup_game_3</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34921"></span>8869</td>
<td class="instruction">LD A,L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34922"></span>886A</td>
<td class="instruction">ADD A,$1B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34924"></span>886C</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34925"></span>886D</td>
<td class="instruction">DEC C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34926"></span>886E</td>
<td class="instruction">JR NZ,<a href="87DC.html#34914">setup_game_2</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34928"></span>8870</td>
<td class="instruction">CALL <a href="83BB.html">$83BB</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34931"></span>8873</td>
<td class="instruction">JP <a href="9D62.html">$9D62</a></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="873C.html">873C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#34780">Map</a></td>
<td class="next">
Next: <a href="8876.html">8876</a>
</td>
</tr>
</table>
<footer>
<div class="release">The incomplete Chase H.Q. disassembly 20230426</div>
<div class="copyright">&copy; 1989 Ocean Software Ltd.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.9.</div>
</footer>
</body>
</html>