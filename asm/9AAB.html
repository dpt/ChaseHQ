<!DOCTYPE html>
<html>
<head>
<title>Chase H.Q.: Routine at 9AAB</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Chase H.Q.</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="9A55.html">9A55</a>
</td>
<td class="up">Up: <a href="../maps/all.html#39595">Map</a></td>
<td class="next">
Next: <a href="9AEC.html">9AEC</a>
</td>
</tr>
</table>
<div class="description">9AAB: Plots a face</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="99EC.html">print_chatter</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Address of face to plot (32x40 bitmap followed by 4x5 attribute bytes)</td>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Address of screen location (real screen)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="39595"></span>9AAB</td>
<td class="instruction">LD BC,$00A0</td>
<td class="comment-1" rowspan="1">Byte length of bitmap - counter</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39598"></span>9AAE</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Save current screen address</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="39599"></span>9AAF</td>
<td class="instruction">PUSH DE</td>
<td class="comment-1" rowspan="1">Save screen address</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39600"></span>9AB0</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="4">Transfer four bytes</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39602"></span>9AB2</td>
<td class="instruction">LDI</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39604"></span>9AB4</td>
<td class="instruction">LDI</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39606"></span>9AB6</td>
<td class="instruction">LDI</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39608"></span>9AB8</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore source address</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39609"></span>9AB9</td>
<td class="instruction">JP PO,<a href="9AAB.html#39630">plot_face_attrs_bit</a></td>
<td class="comment-1" rowspan="1">If <span class="register">BC</span> became zero then proceed to plotting the attributes (PO =&gt; BC == 0)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39612"></span>9ABC</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Move down a scanline</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39613"></span>9ABD</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="3">Loop until we've done 8 lines (we've overflowed into the band bits)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39614"></span>9ABE</td>
<td class="instruction">AND $07</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39616"></span>9AC0</td>
<td class="instruction">JR NZ,$9AAF</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39618"></span>9AC2</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="3">Move down a row (8 lines)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39619"></span>9AC3</td>
<td class="instruction">ADD A,$20</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39621"></span>9AC5</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39622"></span>9AC6</td>
<td class="instruction">JR C,$9AAF</td>
<td class="comment-1" rowspan="1">If carry then loop (overflow is ok)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39624"></span>9AC8</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="3">Step back 8 lines (undo overflow)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39625"></span>9AC9</td>
<td class="instruction">SUB $08</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39627"></span>9ACB</td>
<td class="instruction">LD D,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39628"></span>9ACC</td>
<td class="instruction">JR $9AAF</td>
<td class="comment-1" rowspan="1">Loop</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="39630"></span>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a href="8EB7.html">draw_mugshot</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">plot_face_attrs_bit</td>
<td class="address-2"><span id="39630"></span>9ACE</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore current screen address</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39631"></span>9ACF</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="5">Extract line bits (0..7)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39632"></span>9AD0</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39633"></span>9AD1</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39634"></span>9AD2</td>
<td class="instruction">RRCA</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39635"></span>9AD3</td>
<td class="instruction">AND $03</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39637"></span>9AD5</td>
<td class="instruction">ADD A,$58</td>
<td class="comment-1" rowspan="2">Turn it into an attribute address (works for first band only?)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39639"></span>9AD7</td>
<td class="instruction">LD D,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39640"></span>9AD8</td>
<td class="instruction">LD C,$14</td>
<td class="comment-1" rowspan="1">Byte length of attributes - counter</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="39642"></span>9ADA</td>
<td class="instruction">LDI</td>
<td class="comment-1" rowspan="4">Transfer four attributes</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39644"></span>9ADC</td>
<td class="instruction">LDI</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39646"></span>9ADE</td>
<td class="instruction">LDI</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39648"></span>9AE0</td>
<td class="instruction">LDI</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39650"></span>9AE2</td>
<td class="instruction">RET PO</td>
<td class="comment-1" rowspan="1">If <span class="register">BC</span> became zero then return</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39651"></span>9AE3</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="3">Move down an attribute row</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39652"></span>9AE4</td>
<td class="instruction">ADD A,$1C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39654"></span>9AE6</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39655"></span>9AE7</td>
<td class="instruction">JR NC,$9ADA</td>
<td class="comment-1" rowspan="1">If no carry then loop</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39657"></span>9AE9</td>
<td class="instruction">INC D</td>
<td class="comment-1" rowspan="1">Move down 8 attribute rows</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="39658"></span>9AEA</td>
<td class="instruction">JR $9ADA</td>
<td class="comment-1" rowspan="1">Loop</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="9A55.html">9A55</a>
</td>
<td class="up">Up: <a href="../maps/all.html#39595">Map</a></td>
<td class="next">
Next: <a href="9AEC.html">9AEC</a>
</td>
</tr>
</table>
<footer>
<div class="release">The incomplete Chase H.Q. disassembly 20230426</div>
<div class="copyright">&copy; 1989 Ocean Software Ltd.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.9.</div>
</footer>
</body>
</html>