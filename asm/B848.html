<!DOCTYPE html>
<html>
<head>
<title>Chase H.Q.: Routine at B848</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Chase H.Q.</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="B828.html">B828</a>
</td>
<td class="up">Up: <a href="../maps/all.html#47176">Map</a></td>
<td class="next">
Next: <a href="B8D2.html">B8D2</a>
</td>
</tr>
</table>
<div class="description">B848: Routine at B848</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="8401.html">main_loop</a>, <a href="852A.html">cpu_driver</a> and <a href="873C.html">escape_scene</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">scroll_horizon</td>
<td class="address-2"><span id="47176"></span>B848</td>
<td class="instruction">LD HL,($A24A)</td>
<td class="comment-1" rowspan="4">Return if speed is zero</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47179"></span>B84B</td>
<td class="instruction">LD A,H</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47180"></span>B84C</td>
<td class="instruction">OR L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47181"></span>B84D</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47182"></span>B84E</td>
<td class="instruction">LD A,($A25C)</td>
<td class="comment-1" rowspan="1">A = ?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47185"></span>B851</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set flags</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47186"></span>B852</td>
<td class="instruction">JR Z,<a href="B848.html#47241">scroll_horizon_3</a></td>
<td class="comment-1" rowspan="1">Jump if zero</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47188"></span>B854</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Bank</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47189"></span>B855</td>
<td class="instruction">RR H</td>
<td class="comment-1" rowspan="1">RR H -- shift out carry?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47191"></span>B857</td>
<td class="instruction">RLA</td>
<td class="comment-1" rowspan="1">A &lt;&lt;= 1</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47192"></span>B858</td>
<td class="instruction">RLA</td>
<td class="comment-1" rowspan="1">A &lt;&lt;= 1</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47193"></span>B859</td>
<td class="instruction">RLA</td>
<td class="comment-1" rowspan="1">A &lt;&lt;= 1</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47194"></span>B85A</td>
<td class="instruction">AND $06</td>
<td class="comment-1" rowspan="1">A &amp;= 6</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47196"></span>B85C</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="4">C = ? + C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47197"></span>B85D</td>
<td class="instruction">LD A,($A25D)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47200"></span>B860</td>
<td class="instruction">ADD A,C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47201"></span>B861</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47202"></span>B862</td>
<td class="instruction">LD B,$00</td>
<td class="comment-1" rowspan="1">B = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47204"></span>B864</td>
<td class="instruction">LD HL,$B828</td>
<td class="comment-1" rowspan="1">16 word table at $B828</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47207"></span>B867</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">HL += BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47208"></span>B868</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-1" rowspan="3">BC = wordat(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47209"></span>B869</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47210"></span>B86A</td>
<td class="instruction">LD C,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47211"></span>B86B</td>
<td class="instruction">LD HL,$A25E</td>
<td class="comment-1" rowspan="1">HL = ?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47214"></span>B86E</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-1" rowspan="1">*HL--</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47215"></span>B86F</td>
<td class="instruction">JR NZ,<a href="B848.html#47241">scroll_horizon_3</a></td>
<td class="comment-1" rowspan="1">Jump if non-zero</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47217"></span>B871</td>
<td class="instruction">LD (HL),B</td>
<td class="comment-1" rowspan="1">*HL = B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47218"></span>B872</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Bank</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47219"></span>B873</td>
<td class="instruction">LD A,C</td>
<td class="comment-1" rowspan="1">A = C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47220"></span>B874</td>
<td class="instruction">JP P,<a href="B848.html#47225">scroll_horizon_0</a></td>
<td class="comment-1" rowspan="1">Jump if positive</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47223"></span>B877</td>
<td class="instruction">NEG</td>
<td class="comment-1" rowspan="1">A = -A</td>
</tr>
<tr>
<td class="asm-label">scroll_horizon_0</td>
<td class="address-2"><span id="47225"></span>B879</td>
<td class="instruction">LD HL,$C7E8</td>
<td class="comment-1" rowspan="1">Address of operand in 'LD A,x' at $C7E7</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47228"></span>B87C</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-1" rowspan="1">A += *HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47229"></span>B87D</td>
<td class="instruction">JP P,<a href="B848.html#47234">scroll_horizon_1</a></td>
<td class="comment-1" rowspan="1">Jump if positive</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47232"></span>B880</td>
<td class="instruction">ADD A,$14</td>
<td class="comment-1" rowspan="1">A += 20</td>
</tr>
<tr>
<td class="asm-label">scroll_horizon_1</td>
<td class="address-2"><span id="47234"></span>B882</td>
<td class="instruction">CP $14</td>
<td class="comment-1" rowspan="2">Jump if A &lt; 20</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47236"></span>B884</td>
<td class="instruction">JR C,<a href="B848.html#47240">scroll_horizon_2</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47238"></span>B886</td>
<td class="instruction">SUB $14</td>
<td class="comment-1" rowspan="1">A -= 20</td>
</tr>
<tr>
<td class="asm-label">scroll_horizon_2</td>
<td class="address-2"><span id="47240"></span>B888</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">*HL = A</td>
</tr>
<tr>
<td class="asm-label">scroll_horizon_3</td>
<td class="address-2"><span id="47241"></span>B889</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1">A = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47242"></span>B88A</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">B = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47243"></span>B88B</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1">E = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47244"></span>B88C</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Bank</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47245"></span>B88D</td>
<td class="instruction">LD A,($A258)</td>
<td class="comment-1" rowspan="3">Return if $A258 is zero</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47248"></span>B890</td>
<td class="instruction">OR A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47249"></span>B891</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47250"></span>B892</td>
<td class="instruction">JP P,<a href="B848.html#47256">scroll_horizon_4</a></td>
<td class="comment-1" rowspan="1">Jump if positive</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47253"></span>B895</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="2">E = -(E + 1)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47254"></span>B896</td>
<td class="instruction">NEG</td>
</tr>
<tr>
<td class="asm-label">scroll_horizon_4</td>
<td class="address-2"><span id="47256"></span>B898</td>
<td class="instruction">LD HL,$B827</td>
<td class="comment-1" rowspan="1">32-byte table at $B828</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47259"></span>B89B</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">C = A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47260"></span>B89C</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">HL += BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47261"></span>B89D</td>
<td class="instruction">LD A,($A25B)</td>
<td class="comment-1" rowspan="1">A = ?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47264"></span>B8A0</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">C = A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47265"></span>B8A1</td>
<td class="instruction">LD A,($A23F)</td>
<td class="comment-1" rowspan="2">A = fast_counter - C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47268"></span>B8A4</td>
<td class="instruction">SUB C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47269"></span>B8A5</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set flags</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47270"></span>B8A6</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if non-zero</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47271"></span>B8A7</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-1" rowspan="1">C = *HL</td>
</tr>
<tr>
<td class="asm-label">scroll_horizon_5</td>
<td class="address-2"><span id="47272"></span>B8A8</td>
<td class="instruction">SUB C</td>
<td class="comment-1" rowspan="1">A -= C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47273"></span>B8A9</td>
<td class="instruction">JR C,<a href="B848.html#47281">scroll_horizon_6</a></td>
<td class="comment-1" rowspan="1">Jump if carry</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47275"></span>B8AB</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1">B++</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47276"></span>B8AC</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Bank</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47277"></span>B8AD</td>
<td class="instruction">ADD A,C</td>
<td class="comment-1" rowspan="1">A += C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47278"></span>B8AE</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Bank</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47279"></span>B8AF</td>
<td class="instruction">JR <a href="B848.html#47272">scroll_horizon_5</a></td>
<td class="comment-1" rowspan="1">Jump</td>
</tr>
<tr>
<td class="asm-label">scroll_horizon_6</td>
<td class="address-2"><span id="47281"></span>B8B1</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1">A = B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47282"></span>B8B2</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set flags</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47283"></span>B8B3</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if zero</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47284"></span>B8B4</td>
<td class="instruction">LD HL,$A25A</td>
<td class="comment-1" rowspan="1">HL = ?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47287"></span>B8B7</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-1" rowspan="1">A += *HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47288"></span>B8B8</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">*HL = A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47289"></span>B8B9</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="1">A = B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47290"></span>B8BA</td>
<td class="instruction">RR E</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47292"></span>B8BC</td>
<td class="instruction">LD B,$00</td>
<td class="comment-1" rowspan="1">B = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47294"></span>B8BE</td>
<td class="instruction">JR NC,<a href="B848.html#47299">scroll_horizon_7</a></td>
<td class="comment-1" rowspan="1">Jump if no carry</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47296"></span>B8C0</td>
<td class="instruction">DEC B</td>
<td class="comment-1" rowspan="1">B--</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47297"></span>B8C1</td>
<td class="instruction">NEG</td>
<td class="comment-1" rowspan="1">A = -A</td>
</tr>
<tr>
<td class="asm-label">scroll_horizon_7</td>
<td class="address-2"><span id="47299"></span>B8C3</td>
<td class="instruction">LD HL,($A171)</td>
<td class="comment-1" rowspan="1">HL = horizon_level</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47302"></span>B8C6</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">C = A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47303"></span>B8C7</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">HL += BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47304"></span>B8C8</td>
<td class="instruction">LD ($A171),HL</td>
<td class="comment-1" rowspan="1">write it back</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47307"></span>B8CB</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Bank</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47308"></span>B8CC</td>
<td class="instruction">LD HL,$A25B</td>
<td class="comment-1" rowspan="3">*$A25B += A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47311"></span>B8CF</td>
<td class="instruction">ADD A,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47312"></span>B8D0</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="47313"></span>B8D1</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="B828.html">B828</a>
</td>
<td class="up">Up: <a href="../maps/all.html#47176">Map</a></td>
<td class="next">
Next: <a href="B8D2.html">B8D2</a>
</td>
</tr>
</table>
<footer>
<div class="release">The incomplete Chase H.Q. disassembly 20230518</div>
<div class="copyright">&copy; 1988 Taito Corporation &copy; 1989 Ocean Software Ltd. (Chase H.Q.) © 2023 David Thomas (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.9.</div>
</footer>
</body>
</html>