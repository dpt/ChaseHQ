<!DOCTYPE html>
<html>
<head>
<title>Chase H.Q.: Routine at 860F</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Chase H.Q.</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="85E4.html">85E4</a>
</td>
<td class="up">Up: <a href="../maps/all.html#34319">Map</a></td>
<td class="next">
Next: <a href="865A.html">865A</a>
</td>
</tr>
</table>
<div class="description">860F: Animate the signal meters.</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="858C.html">run_pregame_screen</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="34319"></span>
<div class="comments">
<div class="paragraph">
Update the first meter.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">animate_meters</td>
<td class="address-2"><span id="34319"></span>860F</td>
<td class="instruction">CALL <a href="9618.html#38427">rng</a></td>
<td class="comment-1" rowspan="1">Call rng</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34322"></span>8612</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set flags</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34323"></span>8613</td>
<td class="instruction">LD A,$00</td>
<td class="comment-1" rowspan="1">Self modified counter</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="34325"></span>
<div class="comments">
<div class="paragraph">
Use sign of the random value to enlarge or reduce the apparent meter level.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34325"></span>8615</td>
<td class="instruction">JP P,<a href="860F.html#34332">animate_meters_0</a></td>
<td class="comment-1" rowspan="1">Jump to enlarge case if random value is positive</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34328"></span>8618</td>
<td class="instruction">SUB $01</td>
<td class="comment-1" rowspan="1">Decrement counter [Why use SUB here?]</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34330"></span>861A</td>
<td class="instruction">JR NC,<a href="860F.html#34339">animate_meters_1</a></td>
<td class="comment-1" rowspan="1">Jump if &gt;= 0</td>
</tr>
<tr>
<td class="asm-label">animate_meters_0</td>
<td class="address-2"><span id="34332"></span>861C</td>
<td class="instruction">ADD A,$01</td>
<td class="comment-1" rowspan="1">Increment counter [Why use ADD here?]</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34334"></span>861E</td>
<td class="instruction">CP $08</td>
<td class="comment-1" rowspan="2">Jump if &lt; 8</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34336"></span>8620</td>
<td class="instruction">JR C,<a href="860F.html#34339">animate_meters_1</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34338"></span>8622</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1">Decrement counter (max out at 7)</td>
</tr>
<tr>
<td class="asm-label">animate_meters_1</td>
<td class="address-2"><span id="34339"></span>8623</td>
<td class="instruction">LD ($8614),A</td>
<td class="comment-1" rowspan="1">Self modify counter in $8613</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34342"></span>8626</td>
<td class="instruction">LD HL,$5A17</td>
<td class="comment-1" rowspan="1">Screen attribute (23,16)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34345"></span>8629</td>
<td class="instruction">CALL <a href="860F.html#34374">am_set_attrs</a></td>
<td class="comment-1" rowspan="1">Call am_set_attrs</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="34348"></span>
<div class="comments">
<div class="paragraph">
Update the second meter. Repeats the above.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34348"></span>862C</td>
<td class="instruction">CALL <a href="9618.html#38427">rng</a></td>
<td class="comment-1" rowspan="1">Call rng</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34351"></span>862F</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set flags</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34352"></span>8630</td>
<td class="instruction">LD A,$00</td>
<td class="comment-1" rowspan="1">Self modified counter</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="34354"></span>
<div class="comments">
<div class="paragraph">
Use sign of the random value to enlarge or reduce the apparent meter level.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34354"></span>8632</td>
<td class="instruction">JP P,<a href="860F.html#34361">animate_meters_2</a></td>
<td class="comment-1" rowspan="1">Jump to enlarge case if random value is positive</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34357"></span>8635</td>
<td class="instruction">SUB $01</td>
<td class="comment-1" rowspan="1">Decrement counter [Why use SUB here?]</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34359"></span>8637</td>
<td class="instruction">JR NC,<a href="860F.html#34368">animate_meters_3</a></td>
<td class="comment-1" rowspan="1">Jump if &gt;= 0</td>
</tr>
<tr>
<td class="asm-label">animate_meters_2</td>
<td class="address-2"><span id="34361"></span>8639</td>
<td class="instruction">ADD A,$01</td>
<td class="comment-1" rowspan="1">Increment counter [Why use ADD here?]</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34363"></span>863B</td>
<td class="instruction">CP $08</td>
<td class="comment-1" rowspan="2">Jump if &lt; 8</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34365"></span>863D</td>
<td class="instruction">JR C,<a href="860F.html#34368">animate_meters_3</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34367"></span>863F</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1">Decrement counter (max out at 7)</td>
</tr>
<tr>
<td class="asm-label">animate_meters_3</td>
<td class="address-2"><span id="34368"></span>8640</td>
<td class="instruction">LD ($8631),A</td>
<td class="comment-1" rowspan="1">Self modify counter in $8630</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34371"></span>8643</td>
<td class="instruction">LD HL,$5A57</td>
<td class="comment-1" rowspan="1">Screen attribute (23,18)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="34374"></span>
<div class="comments">
<div class="paragraph">
The signal meter bar is seven segments wide. Fill the left hand portion with our chosen amount of green segments and the right hand side with the complement of red segments.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">am_set_attrs</td>
<td class="address-2"><span id="34374"></span>8646</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set flags from counter in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34375"></span>8647</td>
<td class="instruction">JR Z,<a href="860F.html#34383">am_set_right_attrs</a></td>
<td class="comment-1" rowspan="1">Jump if zero</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34377"></span>8649</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Copy counter to loop counter</td>
</tr>
<tr>
<td class="asm-label">animate_meters_4</td>
<td class="address-2"><span id="34378"></span>864A</td>
<td class="instruction">LD (HL),$60</td>
<td class="comment-1" rowspan="2">Set attribute byte to black ink over green</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34380"></span>864C</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34381"></span>864D</td>
<td class="instruction">DJNZ <a href="860F.html#34378">animate_meters_4</a></td>
<td class="comment-1" rowspan="1">Loop while <span class="register">B</span></td>
</tr>
<tr>
<td class="asm-label">am_set_right_attrs</td>
<td class="address-2"><span id="34383"></span>864F</td>
<td class="instruction">CPL</td>
<td class="comment-1" rowspan="2">A = 7 - A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34384"></span>8650</td>
<td class="instruction">ADD A,$08</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34386"></span>8652</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if zero</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34387"></span>8653</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Copy counter to loop counter</td>
</tr>
<tr>
<td class="asm-label">animate_meters_5</td>
<td class="address-2"><span id="34388"></span>8654</td>
<td class="instruction">LD (HL),$50</td>
<td class="comment-1" rowspan="2">Set attribute byte to black ink over red</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34390"></span>8656</td>
<td class="instruction">INC L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34391"></span>8657</td>
<td class="instruction">DJNZ <a href="860F.html#34388">animate_meters_5</a></td>
<td class="comment-1" rowspan="1">Loop while <span class="register">B</span></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="34393"></span>8659</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="85E4.html">85E4</a>
</td>
<td class="up">Up: <a href="../maps/all.html#34319">Map</a></td>
<td class="next">
Next: <a href="865A.html">865A</a>
</td>
</tr>
</table>
<footer>
<div class="release">The incomplete Chase H.Q. disassembly 20230518</div>
<div class="copyright">&copy; 1988 Taito Corporation &copy; 1989 Ocean Software Ltd. (Chase H.Q.) Â© 2023 David Thomas (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.9.</div>
</footer>
</body>
</html>