<!DOCTYPE html>
<html>
<head>
<title>Chase H.Q.: Routine at 8EB7</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Chase H.Q.</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="8E91.html">8E91</a>
</td>
<td class="up">Up: <a href="../maps/all.html#36535">Map</a></td>
<td class="next">
Next: <a href="8EE7.html">8EE7</a>
</td>
</tr>
</table>
<div class="description">8EB7: Draws a mugshot</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="8E91.html">draw_mugshots</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">BC</td>
<td class="register-desc">Screen position (used for attributes)</td>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Address of last byte of bitmap data to be written (in back buffer)</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Address of mugshot attributes (screen)</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">draw_mugshot</td>
<td class="address-2"><span id="36535"></span>8EB7</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Preserve screen position</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36536"></span>8EB8</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Preserve address of mugshot attributes</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36537"></span>8EB9</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Move back a byte to point at end of bitmap data (we assume that the bitmap data precedes the attribute bytes)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36538"></span>8EBA</td>
<td class="instruction">LD BC,$00A0</td>
<td class="comment-1" rowspan="1">Size of mugshot data (32x40 bitmap)</td>
</tr>
<tr>
<td class="asm-label">dm_loop</td>
<td class="address-2"><span id="36541"></span>8EBD</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="1">Save <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36542"></span>8EBE</td>
<td class="instruction">LDD</td>
<td class="comment-1" rowspan="4">Transfer four bytes (<span class="register">DE</span>, <span class="register">HL</span> and <span class="register">BC</span> are decremented by 4)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36544"></span>8EC0</td>
<td class="instruction">LDD</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36546"></span>8EC2</td>
<td class="instruction">LDD</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36548"></span>8EC4</td>
<td class="instruction">LDD</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36550"></span>8EC6</td>
<td class="instruction">LD E,A</td>
<td class="comment-1" rowspan="1">Restore <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36551"></span>8EC7</td>
<td class="instruction">JP PO,<a href="8EB7.html#36579">dm_plot_attrs</a></td>
<td class="comment-1" rowspan="1">If <span class="register">BC</span> becomes zero then proceed to dm_plot_attrs</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="36554"></span>
<div class="comments">
<div class="paragraph">
Move to next scanline
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36554"></span>8ECA</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="1">Save for checking in a moment</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36555"></span>8ECB</td>
<td class="instruction">DEC D</td>
<td class="comment-1" rowspan="1">Move to next scanline (visually upwards)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36556"></span>8ECC</td>
<td class="instruction">AND $0F</td>
<td class="comment-1" rowspan="1">Would it have rolled over into the top nibble?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36558"></span>8ECE</td>
<td class="instruction">JP NZ,<a href="8EB7.html#36541">dm_loop</a></td>
<td class="comment-1" rowspan="1">No - continue</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="36561"></span>
<div class="comments">
<div class="paragraph">
It rolled over
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36561"></span>8ED1</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="3">Put back the bit stolen by rollover</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36562"></span>8ED2</td>
<td class="instruction">ADD A,$10</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36564"></span>8ED4</td>
<td class="instruction">LD D,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36565"></span>8ED5</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="3">Move to next chunk of 16 scanlines</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36566"></span>8ED6</td>
<td class="instruction">SUB $20</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36568"></span>8ED8</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36569"></span>8ED9</td>
<td class="instruction">JP NC,<a href="8EB7.html#36541">dm_loop</a></td>
<td class="comment-1" rowspan="1">Continue if it didn't roll over</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36572"></span>8EDC</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="3">Otherwise move to the next chunk of 128 scanlines (would put us outside the back buffer)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36573"></span>8EDD</td>
<td class="instruction">SUB $10</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36575"></span>8EDF</td>
<td class="instruction">LD D,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36576"></span>8EE0</td>
<td class="instruction">JP <a href="8EB7.html#36541">dm_loop</a></td>
<td class="comment-1" rowspan="1">Loop</td>
</tr>
<tr>
<td class="asm-label">dm_plot_attrs</td>
<td class="address-2"><span id="36579"></span>8EE3</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore address of mugshot attributes</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="36580"></span>8EE4</td>
<td class="instruction">JP <a href="9AAB.html#39630">pf_attrs_bit</a></td>
<td class="comment-1" rowspan="1">Exit via pf_attrs_bit</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="8E91.html">8E91</a>
</td>
<td class="up">Up: <a href="../maps/all.html#36535">Map</a></td>
<td class="next">
Next: <a href="8EE7.html">8EE7</a>
</td>
</tr>
</table>
<footer>
<div class="release">The incomplete Chase H.Q. disassembly 20230518</div>
<div class="copyright">&copy; 1989 Ocean Software Ltd.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.9.</div>
</footer>
</body>
</html>