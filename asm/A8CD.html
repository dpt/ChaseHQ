<!DOCTYPE html>
<html>
<head>
<title>Chase H.Q.: Routine at A8CD</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Chase H.Q.</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="A89C.html">A89C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#43213">Map</a></td>
<td class="next">
Next: <a href="A955.html">A955</a>
</td>
</tr>
</table>
<div class="description">A8CD: Hazard handler routine? Triggered at road split</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
</div>
</td>
</tr>
<tr>
<td class="asm-label">hazard_handler_a8cd</td>
<td class="address-2"><span id="43213"></span>A8CD</td>
<td class="instruction">LD A,($A230)</td>
<td class="comment-1" rowspan="3">Return if perp_caught_stage &gt; 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43216"></span>A8D0</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43217"></span>A8D1</td>
<td class="instruction">JR NZ,<a href="A8CD.html#43225">hazard_handler_a8cd_0</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43219"></span>A8D3</td>
<td class="instruction">LD A,($A225)</td>
<td class="comment-1" rowspan="3">Check stop_car_spawning flag</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43222"></span>A8D6</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43223"></span>A8D7</td>
<td class="instruction">JR Z,<a href="A8CD.html#43233">hazard_handler_a8cd_1</a></td>
</tr>
<tr>
<td class="asm-label">hazard_handler_a8cd_0</td>
<td class="address-2"><span id="43225"></span>A8D9</td>
<td class="instruction">LD (IX+$0E),$01</td>
<td class="comment-1" rowspan="1">IX[14] = $01  -- horizontal position</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43229"></span>A8DD</td>
<td class="instruction">LD (IX+$0D),$FF</td>
<td class="comment-1" rowspan="1">IX[13] = $FF</td>
</tr>
<tr>
<td class="asm-label">hazard_handler_a8cd_1</td>
<td class="address-2"><span id="43233"></span>A8E1</td>
<td class="instruction">LD C,(IX+$01)</td>
<td class="comment-1" rowspan="1">C = IX[1]  -- buffer offset</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43236"></span>A8E4</td>
<td class="instruction">CALL <a href="A89C.html">get_spawn_lanes</a></td>
<td class="comment-1" rowspan="1">Call get_spawn_lanes</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43239"></span>A8E7</td>
<td class="instruction">LD A,(IX+$11)</td>
<td class="comment-1" rowspan="1">A = IX[17]</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43242"></span>A8EA</td>
<td class="instruction">CP B</td>
<td class="comment-1" rowspan="3">If A &lt; B IX[18] = B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43243"></span>A8EB</td>
<td class="instruction">JR NC,<a href="A8CD.html#43248">hazard_handler_a8cd_2</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43245"></span>A8ED</td>
<td class="instruction">LD (IX+$12),B</td>
</tr>
<tr>
<td class="asm-label">hazard_handler_a8cd_2</td>
<td class="address-2"><span id="43248"></span>A8F0</td>
<td class="instruction">CP C</td>
<td class="comment-1" rowspan="4">If A &gt; C IX[18] = C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43249"></span>A8F1</td>
<td class="instruction">JR Z,<a href="A8CD.html#43256">hazard_handler_a8cd_3</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43251"></span>A8F3</td>
<td class="instruction">JR C,<a href="A8CD.html#43256">hazard_handler_a8cd_3</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43253"></span>A8F5</td>
<td class="instruction">LD (IX+$12),C</td>
</tr>
<tr>
<td class="asm-label">hazard_handler_a8cd_3</td>
<td class="address-2"><span id="43256"></span>A8F8</td>
<td class="instruction">LD A,(IX+$12)</td>
<td class="comment-1" rowspan="1">A = IX[18]</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43259"></span>A8FB</td>
<td class="instruction">CP (IX+$11)</td>
<td class="comment-1" rowspan="2">Jump to <a href="A8CD.html#43302">hazard_handler_a8cd_6</a> if A == IX[17]</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43262"></span>A8FE</td>
<td class="instruction">JR Z,<a href="A8CD.html#43302">hazard_handler_a8cd_6</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43264"></span>A900</td>
<td class="instruction">RL B</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43266"></span>A902</td>
<td class="instruction">LD HL,$A7E6</td>
<td class="comment-1" rowspan="1">HL = $A7E6 -&gt; <a href="A7E7.html">table_a7e7</a> data block</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43269"></span>A905</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">C = A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43270"></span>A906</td>
<td class="instruction">ADD A,L</td>
<td class="comment-1" rowspan="2">L += A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43271"></span>A907</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43272"></span>A908</td>
<td class="instruction">LD A,(IX+$05)</td>
<td class="comment-1" rowspan="1">A = IX[5]</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43275"></span>A90B</td>
<td class="instruction">RR B</td>
<td class="comment-1" rowspan="1">test bottom bit?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43277"></span>A90D</td>
<td class="instruction">JR NC,<a href="A8CD.html#43290">hazard_handler_a8cd_4</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43279"></span>A90F</td>
<td class="instruction">SUB $05</td>
<td class="comment-1" rowspan="1">A -= 5</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43281"></span>A911</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">CP *HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43282"></span>A912</td>
<td class="instruction">JR NC,<a href="A8CD.html#43299">hazard_handler_a8cd_5</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43284"></span>A914</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">A = *HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43285"></span>A915</td>
<td class="instruction">LD (IX+$11),C</td>
<td class="comment-1" rowspan="1">IX[17] = C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43288"></span>A918</td>
<td class="instruction">JR <a href="A8CD.html#43299">hazard_handler_a8cd_5</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="A8CD.html#43299">hazard_handler_a8cd_5</a></td>
</tr>
<tr>
<td class="asm-label">hazard_handler_a8cd_4</td>
<td class="address-2"><span id="43290"></span>A91A</td>
<td class="instruction">ADD A,$05</td>
<td class="comment-1" rowspan="1">A += 5</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43292"></span>A91C</td>
<td class="instruction">CP (HL)</td>
<td class="comment-1" rowspan="1">CP *HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43293"></span>A91D</td>
<td class="instruction">JR C,<a href="A8CD.html#43299">hazard_handler_a8cd_5</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43295"></span>A91F</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">A = *HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43296"></span>A920</td>
<td class="instruction">LD (IX+$11),C</td>
<td class="comment-1" rowspan="1">IX[17] = C</td>
</tr>
<tr>
<td class="asm-label">hazard_handler_a8cd_5</td>
<td class="address-2"><span id="43299"></span>A923</td>
<td class="instruction">LD (IX+$05),A</td>
<td class="comment-1" rowspan="1">IX[5] = A</td>
</tr>
<tr>
<td class="asm-label">hazard_handler_a8cd_6</td>
<td class="address-2"><span id="43302"></span>A926</td>
<td class="instruction">LD A,(IX+$07)</td>
<td class="comment-1" rowspan="1">A = IX[7]</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43305"></span>A929</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Set flags</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43306"></span>A92A</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if zero</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43307"></span>A92B</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Preserve AF</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43308"></span>A92C</td>
<td class="instruction">LD (IX+$07),$00</td>
<td class="comment-1" rowspan="1">IX[7] = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43312"></span>A930</td>
<td class="instruction">LD A,($B326)</td>
<td class="comment-1" rowspan="3">Return if crashed flag set</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43315"></span>A933</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43316"></span>A934</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="43317"></span>
<div class="comments">
<div class="paragraph">
<span class="register">A</span> is zero.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43317"></span>A935</td>
<td class="instruction">LD (IX+$00),A</td>
<td class="comment-1" rowspan="1">IX[0] = 0  -- unused hazard</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43320"></span>A938</td>
<td class="instruction">LD ($A13C),A</td>
<td class="comment-1" rowspan="1">overtake_bonus = 0</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43323"></span>A93B</td>
<td class="instruction">LD A,$96</td>
<td class="comment-1" rowspan="1">A = $96</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43325"></span>A93D</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Restore AF</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43326"></span>A93E</td>
<td class="instruction">CP $03</td>
<td class="comment-1" rowspan="2">Jump if A &lt; 3</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43328"></span>A940</td>
<td class="instruction">JR C,<a href="A8CD.html#43332">hazard_handler_a8cd_7</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43330"></span>A942</td>
<td class="instruction">SUB $03</td>
<td class="comment-1" rowspan="1">A -= 3</td>
</tr>
<tr>
<td class="asm-label">hazard_handler_a8cd_7</td>
<td class="address-2"><span id="43332"></span>A944</td>
<td class="instruction">CALL <a href="A399.html#42168">check_collisions_8</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43335"></span>A947</td>
<td class="instruction">LD HL,$9904</td>
<td class="comment-1" rowspan="1">HL = ouch_chatter</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43338"></span>A94A</td>
<td class="instruction">LD A,$03</td>
<td class="comment-1" rowspan="1">Set priority to 3</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43340"></span>A94C</td>
<td class="instruction">CALL <a href="9945.html">chatter</a></td>
<td class="comment-1" rowspan="1">Call chatter (priority 3)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43343"></span>A94F</td>
<td class="instruction">LD BC,$0302</td>
<td class="comment-1" rowspan="1">BC = $0302</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="43346"></span>A952</td>
<td class="instruction">JP <a href="88F2.html">start_sfx</a></td>
<td class="comment-1" rowspan="1">Call start_sfx</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="A89C.html">A89C</a>
</td>
<td class="up">Up: <a href="../maps/all.html#43213">Map</a></td>
<td class="next">
Next: <a href="A955.html">A955</a>
</td>
</tr>
</table>
<footer>
<div class="release">The incomplete Chase H.Q. disassembly 20231102</div>
<div class="copyright">&copy; 1988 Taito Corporation &copy; 1989 Ocean Software Ltd. (Chase H.Q.) Â© 2023 David Thomas (this disassembly)</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.9.</div>
</footer>
</body>
</html>